# 删除旧文件
echo -e "\033[33;49;1m [deleting monitor files] \033[39;49;0m"
if [ -f "/tmp/monitor.txt" ]; then
    rm /tmp/monitor.txt
fi
if [ -f "./rec_query/galaxylj.txt" ]; then
    rm ./rec_query/galaxylj.txt
fi
if [ -f "./rec_query/photoobjall.txt" ]; then
    rm ./rec_query/photoobjall.txt
fi
if [ -f "./rec_query/photoprimarylj.txt" ]; then
    rm ./rec_query/photoprimarylj.txt
fi
if [ -f "./rec_query/starlj.txt" ]; then
    rm ./rec_query/starlj.txt
fi

ssh gpadmin@node1 << eof
if [ -f "/tmp/monitor1.txt" ]; then
    rm /tmp/monitor1.txt
fi
eof
ssh gpadmin@node2 << eof
if [ -f "/tmp/monitor2.txt" ]; then
    rm /tmp/monitor2.txt
fi
eof
ssh gpadmin@node3 << eof
if [ -f "/tmp/monitor3.txt" ]; then
    rm /tmp/monitor3.txt
fi
eof
ssh gpadmin@node4 << eof
if [ -f "/tmp/monitor4.txt" ]; then
    rm /tmp/monitor4.txt
fi
eof
ssh gpadmin@node5 << eof
if [ -f "/tmp/monitor5.txt" ]; then
    rm /tmp/monitor5.txt
fi
eof
ssh gpadmin@node6 << eof
if [ -f "/tmp/monitor6.txt" ]; then
    rm /tmp/monitor6.txt
fi
eof

# 查询表
sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying galaxylj-1] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/galaxylj-1.sql" >> ./rec_query/galaxylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying photoobjall-1] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/photoobjall-1.sql" >> ./rec_query/photoobjall.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
sleep 2
echo -e "\033[32;49;1m [querying photoprimarylj-1] \033[39;49;0m"
psql -d astronomy -f "./sql/photoprimarylj-1.sql" >> ./rec_query/photoprimarylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying starlj] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/starlj.sql" >> ./rec_query/starlj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying galaxylj-2] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/galaxylj-2.sql" >> ./rec_query/galaxylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying photoobjall-2] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/photoobjall-2.sql" >> ./rec_query/photoobjall.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying photoprimarylj-2] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/photoprimarylj-2.sql" >> ./rec_query/photoprimarylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying galaxylj-3] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/galaxylj-3.sql" >> ./rec_query/galaxylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying photoobjall-3] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/photoobjall-3.sql" >> ./rec_query/photoobjall.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying galaxylj-4] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/galaxylj-4.sql" >> ./rec_query/galaxylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying photoobjall-4] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/photoobjall-4.sql" >> ./rec_query/photoobjall.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [querying galaxylj-5] \033[39;49;0m"
sleep 2
psql -d astronomy -f "./sql/galaxylj-5.sql" >> ./rec_query/galaxylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

# 汇总结果
# scp files
echo -e "\033[32;49;1m [scp files] \033[39;49;0m"
echo -e "\033[33;49;1m [node1 scp] \033[39;49;0m"
ssh gpadmin@node1 << eof
if [ -f "/tmp/monitor1.txt" ]; then
   scp -o StrictHostKeyChecking=no /tmp/monitor1.txt gpadmin@JPDB2:/tmp 
fi
eof
echo -e "\033[33;49;1m [node2 scp] \033[39;49;0m"
ssh gpadmin@node2 << eof
if [ -f "/tmp/monitor2.txt" ]; then
   scp -o StrictHostKeyChecking=no /tmp/monitor2.txt gpadmin@JPDB2:/tmp 
fi
eof
echo -e "\033[33;49;1m [node3 scp] \033[39;49;0m"
ssh gpadmin@node3 << eof
if [ -f "/tmp/monitor3.txt" ]; then
   scp -o StrictHostKeyChecking=no /tmp/monitor3.txt gpadmin@JPDB2:/tmp 
fi
eof
echo -e "\033[33;49;1m [node4 scp] \033[39;49;0m"
ssh gpadmin@node4 << eof
if [ -f "/tmp/monitor4.txt" ]; then
   scp -o StrictHostKeyChecking=no /tmp/monitor4.txt gpadmin@JPDB2:/tmp 
fi
eof
echo -e "\033[33;49;1m [node5 scp] \033[39;49;0m"
ssh gpadmin@node5 << eof
if [ -f "/tmp/monitor5.txt" ]; then
   scp -o StrictHostKeyChecking=no /tmp/monitor5.txt gpadmin@JPDB2:/tmp 
fi
eof
echo -e "\033[33;49;1m [node6 scp] \033[39;49;0m"
ssh gpadmin@node6 << eof
if [ -f "/tmp/monitor6.txt" ]; then
   scp -o StrictHostKeyChecking=no /tmp/monitor6.txt gpadmin@JPDB2:/tmp 
fi
eof

echo -e "\033[32;49;1m [querying moving monitor files] \033[39;49;0m"
mv /tmp/monitor.txt /tmp/monitor1.txt /tmp/monitor2.txt /tmp/monitor3.txt /tmp/monitor4.txt /tmp/monitor5.txt /tmp/monitor6.txt ./rec_query

# 执行完毕
echo -e "\033[32;49;1m [Operation Complete] \033[39;49;0m"

