# 删除旧文件
echo -e "\033[33;49;1m [deleting monitor files] \033[39;49;0m"
if [ -f "/tmp/monitor.txt" ]; then
    rm /tmp/monitor.txt
fi
if [ -f "./rec_load/galaxylj.txt" ]; then
    rm ./rec_load/galaxylj.txt
fi
if [ -f "./rec_load/photoobjall.txt" ]; then
    rm ./rec_load/photoobjall.txt
fi
if [ -f "./rec_load/photoprimarylj.txt" ]; then
    rm ./rec_load/photoprimarylj.txt
fi
if [ -f "./rec_load/starlj.txt" ]; then
    rm ./rec_load/starlj.txt
fi
if [ -f "./rec_load/neighbors.txt" ]; then
    rm ./rec_load/neighbors.txt
fi

ssh gpadmin@node1 << eof
if [ -f "/tmp/monitor1.txt" ]; then
    rm /tmp/monitor1.txt
fi
eof
ssh gpadmin@node2 << eof
if [ -f "/tmp/monitor2.txt" ]; then
    rm /tmp/monitor2.txt
fi
eof
ssh gpadmin@node3 << eof
if [ -f "/tmp/monitor3.txt" ]; then
    rm /tmp/monitor3.txt
fi
eof
ssh gpadmin@node4 << eof
if [ -f "/tmp/monitor4.txt" ]; then
    rm /tmp/monitor4.txt
fi
eof
ssh gpadmin@node5 << eof
if [ -f "/tmp/monitor5.txt" ]; then
    rm /tmp/monitor5.txt
fi
eof
ssh gpadmin@node6 << eof
if [ -f "/tmp/monitor6.txt" ]; then
    rm /tmp/monitor6.txt
fi
eof

# 导入表
sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [loading galaxylj] \033[39;49;0m"
sleep 2
gpload -f /home/gpadmin/astronomy_data/10G/galaxylj10.yaml > ./rec_load/galaxylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [loading photoobjall] \033[39;49;0m"
sleep 2
gpload -f /home/gpadmin/astronomy_data/10G/photoobjall10.yaml > ./rec_load/photoobjall.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [loading photoprimarylj] \033[39;49;0m"
sleep 2
gpload -f /home/gpadmin/astronomy_data/10G/photoprimarylj10.yaml > ./rec_load/photoprimarylj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [loading starlj] \033[39;49;0m"
sleep 2
gpload -f /home/gpadmin/astronomy_data/10G/starlj10.yaml > ./rec_load/starljlj.txt
sleep 2
sh ./monitor/monitor_stop.sh

sh ./monitor/monitor_start.sh
echo -e "\033[32;49;1m [loading neighbors] \033[39;49;0m"
sleep 2
gpload -f /home/gpadmin/astronomy_data/10G/neighbors10.yaml > ./rec_load/neighbors.txt
sleep 2
sh ./monitor/monitor_stop.sh

# 得到表的大小
echo -e "\033[32;49;1m [get table size] \033[39;49;0m"
psql -d astronomy -f "./sql/table_size.sql" >> ./rec_load/table_size.txt

# 汇总结果
echo -e "\033[32;49;1m [moving monitor files] \033[39;49;0m"
mv /tmp/monitor.txt /tmp/monitor1.txt /tmp/monitor2.txt /tmp/monitor3.txt /tmp/monitor4.txt /tmp/monitor5.txt /tmp/monitor6.txt ./rec_query

# 操作完成
echo -e "\033[32;49;1m [Operation Complete] \033[39;49;0m"

